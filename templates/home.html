{% extends "base.html" %}
{% block title %}Browse the Library{% endblock %}

{% block content %}
<h1 class="page-title">The <span>Collection</span></h1>
<p class="page-subtitle">Every book a doorway. Every author a world.</p>
<hr class="divider" />

<form class="search-bar" method="GET" action="/">
  <input type="hidden" name="sort" value="{{ sort }}" />
  <input class="search-input" type="text" name="q" value="{{ search }}"
         placeholder="Search by title or authorâ€¦" />
  <button type="submit" class="btn btn-primary btn-search">Search</button>
  {% if search %}
    <a href="{{ url_for('home', sort=sort) }}" class="btn btn-ghost">Clear</a>
  {% endif %}
</form>

<div class="sort-bar">
  <span class="sort-label">Sort by:</span>
  <a href="{{ url_for('home', sort='title', q=search) }}"
     class="btn btn-ghost btn-sort {% if sort == 'title' %}active{% endif %}">
    Title
  </a>
  <a href="{{ url_for('home', sort='author', q=search) }}"
     class="btn btn-ghost btn-sort {% if sort == 'author' %}active{% endif %}">
    Author
  </a>
</div>

{% if books %}
  <div class="book-grid">
    {% for book in books %}
    <div class="book-card">
      {% if book.isbn %}
        <img
          class="book-cover"
          src="https://covers.openlibrary.org/b/isbn/{{ book.isbn }}-M.jpg"
          alt="{{ book.title }} cover"
          onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
        />
        <div class="book-cover-placeholder" style="display:none;">ðŸ“–</div>
      {% else %}
        <div class="book-cover-placeholder">ðŸ“–</div>
      {% endif %}
      <div class="book-info">
        <div class="book-title">{{ book.title }}</div>
        <div class="book-author">{{ book.author.name if book.author else 'Unknown Author' }}</div>
        {% if book.publication_year %}
          <div class="book-year">{{ book.publication_year }}</div>
        {% endif %}
      </div>
      <form method="POST" action="{{ url_for('delete_book', book_id=book.id) }}">
        <button type="submit" class="btn-delete"
                onclick="return confirm('Remove this book from the library?')">
          âœ• Remove
        </button>
      </form>
    </div>
    {% endfor %}
  </div>
{% elif search %}
  <div class="empty-state">
    <p>No books found matching "{{ search }}".</p>
    <a href="{{ url_for('home', sort=sort) }}" class="btn btn-ghost">Clear search</a>
  </div>
{% else %}
  <div class="empty-state">
    <p>The shelves are bare â€” no books yet.</p>
    <a href="/add_author" class="btn btn-primary">Add an Author first</a>
  </div>
{% endif %}
{% endblock %}
